<!doctype html><html lang=en-us><head><title>HTTPS in ASP.NET Core using Middleware</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="HTTPS is now a common practice when hosting web applications. In this blog post, I will show you how to enforce SSL in an ASP.NET Core application using only middleware."><meta property="article:published_time" content="17-07-2017 00:00:00"><link async href="https://fonts.googleapis.com/css2?family=Jura:wght@300;400;500;600;700&display=swap" rel=stylesheet><link async rel=stylesheet href=/css/main.css type=text/css><link async rel=icon href=/favicon.ico><script async src=https://kit.fontawesome.com/0d71694d01.js crossorigin=anonymous></script></head><body><div class=grid-container><header class=header><div class=header-collection><div class=header-item><a class=header-item__link href=/><h1 class=header-item__title>Homepage | Rune Nielsen</h1></a></div></div><div class=header-collection><div class=header-item><a class=header-item__link target=_blank href=https://github.com/runeanielsen><p class=header-item__icon><i class="fab fa-github-square"></i></p></a></div><div class=header-item><a class=header-item__link target=_blank href=https://linkedin.com/in/runeanielsen><p class=header-item__icon><i class="fab fa-linkedin"></i></p></a></div></div></header><div class=blog-post><h1 class=blog-post__title>HTTPS in ASP.NET Core using Middleware</h1><p class=blog-post__date>Mon, Jul 10, 2017</p><article class=blog-post__content><p>HTTPS is now a common practice when hosting web applications. In this blog post, I will show you how to enforce SSL in an ASP.NET Core application using only middleware.</p><p>The blog post will be based on an empty ASP.NET Core 1.1 application created using the empty template in Visual Studio 2017.</p><p><img src=/blogpost/9dcea12d-8ffd-438a-9c78-5f04a789b457.png alt="Shows the interface for creating an Empty ASP.NET Core solution"></p><p>The following dependencies will, therefore, be installed by default.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;ItemGroup&gt;</span>
    <span style=color:#f92672>&lt;PackageReference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;Microsoft.ApplicationInsights.AspNetCore&#34;</span> <span style=color:#a6e22e>Version=</span><span style=color:#e6db74>&#34;2.0.0&#34;</span> <span style=color:#f92672>/&gt;</span>
    <span style=color:#f92672>&lt;PackageReference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;Microsoft.AspNetCore&#34;</span> <span style=color:#a6e22e>Version=</span><span style=color:#e6db74>&#34;1.1.2&#34;</span> <span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;/ItemGroup&gt;</span>
</code></pre></div><h2 id=setup>Setup</h2><p>To enforce SSL we need to get the following package.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;PackageReference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;Microsoft.AspNetCore.Mvc&#34;</span> <span style=color:#a6e22e>Version=</span><span style=color:#e6db74>&#34;1.1.2&#34;</span> <span style=color:#f92672>/&gt;</span>
</code></pre></div><p>The reason for the requirement of the package is that we need the MvcOptions object to configure the requirement for SSL. To use the object go into the &ldquo;Startup.cs&rdquo; file and inside of the &ldquo;ConfigureServices&rdquo; method add the following code, so the whole method looks like this. The configuration below now requires all requests to use HTTPS.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> ConfigureServices(IServiceCollection services)
{
    services.Configure&lt;MvcOptions&gt;(options =&gt;
    {
        options.Filters.Add(<span style=color:#66d9ef>new</span> RequireHttpsAttribute());
    });
}
</code></pre></div><p>Now that all requests require HTTPS, we should also implement a redirect rule, so all requests using HTTP get redirected to HTTPS. To do that install the following package. The package enables us to use rewrite middleware, so we can rewrite to HTTPS on HTTP requests.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;PackageReference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;Microsoft.AspNetCore.Rewrite&#34;</span> <span style=color:#a6e22e>Version=</span><span style=color:#e6db74>&#34;1.0.2&#34;</span> <span style=color:#f92672>/&gt;</span>
</code></pre></div><p>After the package has been installed, go to the &ldquo;Configure&rdquo; method in the &ldquo;Startup.cs&rdquo; file and add the following code.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> Configure(IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory)
{
    <span style=color:#66d9ef>var</span> options = <span style=color:#66d9ef>new</span> RewriteOptions()
        .AddRedirectToHttps();

    app.UseRewriter(options);
}
</code></pre></div><p>Now, whenever a request is made on HTTP it gets redirect to HTTPS, and our controllers no longer respond to HTTP requests.</p></article></div></div></body></html>